<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Benchmarks</title>
  <link rel="icon" href="favicon.ico" sizes="16x16 32x32" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon_180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="favicon_192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,600;1,6..72,400&family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f4f1;
      --surface: #ffffff;
      --surface-alt: #f2f1ee;
      --text: #111111;
      --muted: #6b6b6b;
      --subtle: #ababab;
      --line: #e2e1de;
      --line-soft: #edece9;
      --accent: #1d4ed8;
      --accent-hover: #1e40af;
      --top-score-text: var(--accent);
      --font-display: "Newsreader", Georgia, serif;
      --font-ui: "DM Sans", "Segoe UI", sans-serif;
      --font-mono: "JetBrains Mono", "Consolas", monospace;
      --radius: 10px;
      --shadow: 0 1px 4px rgba(0, 0, 0, 0.06), 0 6px 24px rgba(0, 0, 0, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-y: scroll;
    }

    html,
    body {
      min-height: 100%;
      background: var(--bg);
      background-image: radial-gradient(circle, #ccc9c2 1px, transparent 1px);
      background-size: 22px 22px;
      color: var(--text);
      font-family: var(--font-ui);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .page {
      width: min(2400px, 96vw);
      margin: 32px auto;
      background: var(--surface);
      border: 1px solid var(--line);
      border-left: 3px solid var(--accent);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* ── Hero ─────────────────────────────────────── */

    .hero {
      padding: 32px 40px 26px;
      border-bottom: 1px solid var(--line);
      animation: fadeIn 350ms ease;
      position: relative;
    }

    .hero h1 {
      font-family: var(--font-display);
      font-size: clamp(1.8rem, 3vw, 2.6rem);
      font-weight: 600;
      letter-spacing: -0.025em;
      line-height: 1.1;
      color: var(--text);
    }

    .hero p {
      margin-top: 8px;
      color: var(--muted);
      max-width: 800px;
      line-height: 1.5;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    /* ── Controls ─────────────────────────────────── */

    .controls {
      padding: 20px 40px;
      background: var(--surface);
      border-bottom: 1px solid var(--line);
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      align-items: start;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-width: 0;
    }

    .field label {
      color: var(--subtle);
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-family: var(--font-mono);
    }

    input[type="text"],
    select {
      width: 100%;
      height: 42px;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 0 12px;
      font-size: 0.87rem;
      background: var(--surface);
      color: var(--text);
      font-family: var(--font-ui);
      font-weight: 600;
      transition: border-color 150ms ease, box-shadow 150ms ease;
      -webkit-appearance: none;
      appearance: none;
      outline: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23ababab' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 32px;
    }

    select[multiple] {
      background-image: none;
      padding: 4px 12px 8px;
      font-size: 0.80rem;
      font-weight: 700;
      color: var(--muted);
      transition: height 200ms ease;
      scrollbar-width: none;
    }

    select[multiple].has-selection {
      color: var(--text);
    }

    select[multiple]::-webkit-scrollbar {
      display: none;
    }

    select[multiple] option {
      font-weight: 700;
    }

    .select-wrap {
      position: relative;
    }

    /* ── Model compare custom widget ──────────────────── */

    .model-compare-widget {
      width: 100%;
      max-height: 42px;
      overflow-y: auto;
      overscroll-behavior: contain;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding-top: 5px;
      background: var(--surface);
      cursor: pointer;
      outline: none;
      transition: border-color 150ms ease, box-shadow 150ms ease, max-height 200ms ease;
      scrollbar-width: none;
    }

    .model-compare-widget::-webkit-scrollbar { display: none; }

    .model-compare-widget.open {
      max-height: 260px;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
    }

    .model-compare-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      font-size: 0.80rem;
      font-weight: 700;
      font-family: var(--font-mono);
      color: var(--muted);
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background 80ms ease, color 80ms ease;
    }

    .model-compare-item:hover {
      background: var(--surface-alt);
      color: var(--text);
    }

    .model-compare-item.selected {
      color: var(--accent);
    }

    .model-compare-item.selected:hover {
      background: rgba(29, 78, 216, 0.05);
    }

    .model-compare-check {
      flex-shrink: 0;
      width: 13px;
      height: 13px;
      border-radius: 3px;
      border: 1.5px solid var(--subtle);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 80ms ease, border-color 80ms ease;
    }

    .model-compare-item.selected .model-compare-check {
      background: var(--accent);
      border-color: var(--accent);
    }

    .model-compare-item.selected .model-compare-check::after {
      content: "✓";
      font-size: 9px;
      color: white;
      font-family: var(--font-ui);
      font-weight: 900;
      line-height: 1;
      margin-top: -1px;
      display: block;
    }

    .clear-compare {
      position: absolute;
      top: 50%;
      right: 6px;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      min-height: unset;
      min-width: unset;
      padding: 0;
      border-radius: 4px;
      border: none;
      background: none;
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-ui);
      transition: color 120ms ease;
      z-index: 10;
    }

    .clear-compare:hover {
      color: var(--text);
    }


    input[type="text"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
    }

    button:focus-visible,
    th:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .check {
      flex-direction: row;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      font-size: 0.88rem;
      color: var(--muted);
      font-weight: 600;
    }

    /* ── Toolbar ──────────────────────────────────── */

    .toolbar {
      padding: 10px 40px 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      border-bottom: 1px solid var(--line);
      background: var(--surface-alt);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
      min-height: 32px;
      min-width: 150px;
      border-radius: 8px;
      background: var(--surface);
      color: var(--muted);
      border: 1px solid var(--line);
      font-size: 0.78rem;
      font-weight: 700;
      font-family: var(--font-mono);
      letter-spacing: 0.03em;
    }

    button {
      border: 1px solid var(--line);
      background: var(--surface);
      border-radius: 8px;
      color: var(--muted);
      min-height: 32px;
      min-width: 150px;
      padding: 0 12px;
      font-size: 0.78rem;
      font-weight: 700;
      cursor: pointer;
      font-family: var(--font-ui);
      letter-spacing: 0.03em;
      transition: background-color 120ms ease, color 120ms ease, border-color 120ms ease;
    }

    button:hover {
      background: var(--surface-alt);
      color: var(--text);
      border-color: #c4c3c0;
    }

    .file-input-offscreen {
      position: fixed;
      left: -9999px;
      top: -9999px;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    }

    /* ── Table ────────────────────────────────────── */

    .table-shell {
      overflow: auto;
      max-height: calc(100vh - 260px);
      min-height: 300px;
    }

    table {
      width: max(1160px, 100%);
      border-collapse: separate;
      border-spacing: 0;
      font-size: 0.82rem;
    }

    thead th {
      position: sticky;
      top: 0;
      z-index: 2;
      background: var(--surface-alt);
      border-bottom: 1px solid var(--line);
      padding: 10px 10px;
      text-align: left;
      color: var(--muted);
      white-space: nowrap;
      cursor: pointer;
      user-select: none;
      transition: color 120ms ease, background-color 120ms ease;
      font-family: var(--font-mono);
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      overflow: visible;
    }

    thead th:hover {
      background: #eae9e6;
      color: var(--text);
    }

    /* Sorted column: subtle tint */
    thead th:has(.sort-indicator) {
      background: #e2e1de !important;
      color: var(--text) !important;
      border-bottom-color: #c9c8c4 !important;
      text-align: left;
    }

    thead th:has(.sort-indicator):hover {
      background: #d8d7d3 !important;
    }

    /* Sticky first column */
    th:first-child,
    td:first-child {
      position: sticky;
      left: 0;
      z-index: 1;
      background: var(--surface);
    }

    thead th:first-child {
      z-index: 3;
      background: var(--surface-alt);
    }

    thead th:first-child:has(.sort-indicator) {
      background: #e2e1de !important;
    }

    tbody td {
      border-bottom: 1px solid var(--line-soft);
      padding: 9px 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    tbody tr {
      background: var(--surface);
    }

    tbody tr:nth-child(even) {
      background: #fafaf8;
    }

    /* sticky first column needs explicit background since td overrides tr */
    tbody tr:nth-child(even) td:first-child {
      background: #fafaf8;
    }

    tbody tr:hover {
      background: #eeeeed;
    }

    tbody tr:hover td:first-child {
      background: #eeeeed;
    }

    .col-model {
      min-width: 220px;
      max-width: 340px;
      font-family: var(--font-mono);
      font-weight: 700;
      color: var(--text);
    }

    td.col-model {
      font-size: 0.82rem;
    }

    .col-model a {
      color: var(--text);
      font-weight: 700;
      text-decoration: none;
    }

    .col-model a:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    .creator {
      font-family: var(--font-mono);
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--muted);
    }

    .creator a {
      color: var(--muted);
      text-decoration: none;
      font-weight: 500;
    }

    .creator a:hover {
      color: var(--text);
    }

    .mono,
    .num {
      font-family: var(--font-mono);
    }

    .num {
      text-align: right;
      font-weight: 700;
      color: var(--text);
    }

    td.mono {
      text-align: right;
    }

    td.num {
      font-size: 0.82rem;
      padding-right: 14px;
    }

    .num.na {
      color: var(--subtle);
      font-style: normal;
      font-weight: 400;
    }

    /* Top score: td bg matches its row so span corners are invisible */
    .top-score {
      color: var(--top-score-text) !important;
      padding: 0 !important;
    }

    .top-score.num {
      font-weight: 700;
    }

    tbody tr:nth-child(odd) td.top-score  { background: var(--surface); }
    tbody tr:nth-child(even) td.top-score { background: #fafaf8; }
    tbody tr:hover td.top-score           { background: #eeeeed !important; }

    /* Gradient lives on the inner span with border-radius */
    .top-score-mark {
      display: block;
      padding: 9px 14px 9px 10px;
      background: linear-gradient(to right, rgba(210, 222, 255, 0) 20%, rgba(210, 222, 255, 1));
      border-radius: 0 6px 6px 0;
    }

    /* ── New model badge ───────────────────────────── */

    .model-new {
      color: #991b1b !important;
    }

    .new-badge {
      display: inline-block;
      vertical-align: middle;
      margin-left: 4px;
      position: relative;
      top: -1px;
      user-select: none;
      flex-shrink: 0;
      line-height: 0;
    }

    .sort-indicator {
      position: absolute;
      right: 8px;
      top: 45%;
      transform: translateY(-50%);
      color: var(--accent);
      font-weight: 800;
      font-size: 0.72rem;
    }

    .bench-head {
      max-width: 120px;
    }

    .bench-head .th-label {
      display: inline-block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
      vertical-align: middle;
    }

    thead th:has(.sort-indicator) .th-label {
      display: inline-block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: calc(100% - 8px);
      vertical-align: middle;
    }


    .empty {
      margin: 24px;
      padding: 40px;
      text-align: center;
      color: var(--muted);
      border: 1px dashed var(--line);
      border-radius: 10px;
      background: var(--surface);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .status {
      padding: 40px;
      color: var(--muted);
      font-weight: 600;
    }

    .status.error {
      color: #991b1b;
    }

    /* ── Benchmarks panel ─────────────────────────── */

    .benchmarks-panel {
      margin: 0;
      padding: 28px 40px 36px;
      border-top: 1px solid var(--line);
      background: var(--surface-alt);
    }

    .benchmarks-panel h2 {
      margin: 0 0 14px;
      color: var(--subtle);
      font-size: 0.68rem;
      font-weight: 700;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      font-family: var(--font-mono);
    }

    .benchmarks-list {
      display: grid;
      gap: 8px;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }

    .benchmark-item {
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 12px 14px;
      background: var(--surface);
      transition: border-color 150ms ease;
      display: flex;
      flex-direction: column;
    }

    .benchmark-item:hover {
      border-color: #bbb;
    }

    .benchmark-head {
      display: flex;
      gap: 8px;
      align-items: baseline;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    .benchmark-name {
      font-weight: 700;
      color: var(--text);
      font-size: 0.88rem;
    }

    .benchmark-category {
      color: var(--subtle);
      font-size: 0.68rem;
      font-weight: 700;
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .benchmark-desc {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
      font-size: 0.82rem;
      font-weight: 500;
    }

    .benchmark-links {
      margin-top: auto;
      padding-top: 8px;
      display: block;
    }

    .benchmark-links a {
      display: block;
      color: var(--accent);
      text-decoration: none;
      font-size: 0.76rem;
      font-weight: 600;
      font-family: var(--font-mono);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .benchmark-links a:hover {
      text-decoration: underline;
    }

    /* ── Sources panel ────────────────────────────── */

    .sources-panel {
      margin: 0;
      padding: 20px 40px 28px;
      border-top: 1px solid var(--line);
      background: var(--surface);
    }

    .sources-panel h2 {
      margin: 0 0 10px;
      color: var(--subtle);
      font-size: 0.68rem;
      font-weight: 700;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      font-family: var(--font-mono);
    }

    .sources-list {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .sources-list a {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 500;
      font-family: var(--font-mono);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      transition: color 120ms ease;
    }

    .sources-list a:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    @media (max-width: 860px) {
      .sources-panel {
        padding-left: 16px;
        padding-right: 16px;
        padding-bottom: 20px;
      }
    }

    /* ── Theme toggle ──────────────────────────────── */

    .theme-toggle {
      position: absolute;
      top: 28px;
      right: 36px;
      width: 36px;
      height: 36px;
      min-width: unset;
      min-height: unset;
      padding: 0;
      border-radius: 50%;
      border: 1px solid var(--line);
      background: var(--surface);
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 120ms ease, color 120ms ease, border-color 120ms ease, transform 120ms ease;
    }

    .theme-toggle:hover {
      background: var(--surface-alt);
      color: var(--text);
      border-color: var(--subtle);
      transform: scale(1.08);
    }

    .theme-toggle svg {
      width: 16px;
      height: 16px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      flex-shrink: 0;
    }

    .theme-toggle .icon-sun { display: block; }
    .theme-toggle .icon-moon { display: none; }
    [data-theme="dark"] .theme-toggle .icon-sun { display: none; }
    [data-theme="dark"] .theme-toggle .icon-moon { display: block; }

    @media (max-width: 860px) {
      .theme-toggle {
        top: 20px;
        right: 16px;
      }
    }

    /* ── Dark mode ─────────────────────────────────── */

    [data-theme="dark"] {
      --bg: #0e0d0b;
      --surface: #161513;
      --surface-alt: #1c1b18;
      --text: #e0ddd7;
      --muted: #9a9793;
      --subtle: #6c6a66;
      --line: #2b2a27;
      --line-soft: #222120;
      --accent: #5b8af7;
      --accent-hover: #7aa3f8;
      --shadow: 0 1px 4px rgba(0, 0, 0, 0.4), 0 6px 24px rgba(0, 0, 0, 0.4);
      background-image: radial-gradient(circle, #252320 1px, transparent 1px);
    }

    [data-theme="dark"] body {
      background-image: radial-gradient(circle, #252320 1px, transparent 1px);
    }

    [data-theme="dark"] select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237a7773' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    }

    [data-theme="dark"] tbody tr:nth-child(even),
    [data-theme="dark"] tbody tr:nth-child(even) td:first-child {
      background: #131210;
    }

    [data-theme="dark"] tbody tr:hover,
    [data-theme="dark"] tbody tr:hover td:first-child {
      background: #252421;
    }

    [data-theme="dark"] tbody tr:nth-child(odd) td.top-score  { background: var(--surface); }
    [data-theme="dark"] tbody tr:nth-child(even) td.top-score { background: #131210; }
    [data-theme="dark"] tbody tr:hover td.top-score           { background: #252421 !important; }

    [data-theme="dark"] .top-score-mark {
      background: linear-gradient(to right, rgba(40, 65, 155, 0) 20%, rgba(45, 70, 160, 0.45));
    }

    [data-theme="dark"] thead th:hover {
      background: #232220;
      color: var(--text);
    }

    [data-theme="dark"] thead th:has(.sort-indicator) {
      background: #252422 !important;
      border-bottom-color: #3a3936 !important;
    }

    [data-theme="dark"] thead th:has(.sort-indicator):hover {
      background: #2c2b28 !important;
    }

    [data-theme="dark"] thead th:first-child:has(.sort-indicator) {
      background: #252422 !important;
    }

    [data-theme="dark"] .model-new {
      color: #f87171 !important;
    }

    [data-theme="dark"] .status.error {
      color: #f87171;
    }

    [data-theme="dark"] .benchmark-item:hover {
      border-color: #4a4845;
    }

    [data-theme="dark"] button:hover {
      border-color: #3a3936;
    }

    /* Smooth transition when switching themes */
    html.theme-transitioning,
    html.theme-transitioning *,
    html.theme-transitioning *::before,
    html.theme-transitioning *::after {
      transition: background-color 300ms ease, color 300ms ease, border-color 300ms ease !important;
    }

    /* ── Animations ───────────────────────────────── */

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ── Column resize handles ────────────────────── */

    thead th {
      overflow: visible;
    }

    .col-resize-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 6px;
      height: 100%;
      cursor: col-resize;
      z-index: 4;
      background: transparent;
      transition: background-color 100ms ease;
    }

    thead th:has(.sort-indicator) .col-resize-handle:hover,
    thead th:has(.sort-indicator) .col-resize-handle:active {
      background: rgba(0, 0, 0, 0.1);
    }

    thead th:not(:has(.sort-indicator)) .col-resize-handle:hover,
    thead th:not(:has(.sort-indicator)) .col-resize-handle:active {
      background: rgba(0, 0, 0, 0.1);
    }

    body.col-resizing {
      cursor: col-resize !important;
      user-select: none !important;
    }

    body.col-resizing * {
      cursor: col-resize !important;
    }

    /* ── Responsive ───────────────────────────────── */

    @media (max-width: 860px) {
      .page {
        width: 100vw;
        margin: 0;
        border-radius: 0;
        border-left-width: 3px;
        min-height: 100vh;
      }

      .hero,
      .controls,
      .toolbar {
        padding-left: 16px;
        padding-right: 16px;
      }

      .benchmarks-panel {
        padding-left: 16px;
        padding-right: 16px;
        padding-bottom: 24px;
      }

      .table-shell {
        max-height: none;
        min-height: 220px;
      }

      table {
        width: max(1020px, 100%);
      }
    }
  </style>
  <script>
    // Set theme before first paint to avoid FOUC
    (function () {
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      if (saved === "dark" || (!saved && prefersDark)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    })();
  </script>
</head>
<body>
  <!-- Shared SVG defs for the "NEW" sticker badge (defined once to avoid duplicate IDs) -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden;">
    <defs>
      <filter id="new-badge-shadow" x="-25%" y="-25%" width="150%" height="150%">
        <feDropShadow dx="5" dy="8" stdDeviation="8" flood-color="#000000" flood-opacity="0.28"/>
      </filter>
      <linearGradient id="new-badge-grad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#FF4B2B"/>
        <stop offset="100%" stop-color="#E21B4D"/>
      </linearGradient>
    </defs>
  </svg>
  <main class="page" id="app" aria-live="polite">
    <section class="hero">
      <button id="themeToggle" class="theme-toggle" type="button" title="Toggle dark mode" aria-label="Toggle dark mode">
        <svg class="icon-sun" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="12" cy="12" r="4"/>
          <line x1="12" y1="2" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="22"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="2" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="22" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg class="icon-moon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      <h1 id="title">LLM Benchmarks</h1>
      <p>Compare performance of small(ish) LLM models across benchmark suites.</p>
    </section>

    <section class="controls" id="controls" hidden>
      <div class="field">
        <label for="modelCompare">Compare Models</label>
        <div class="select-wrap">
          <div id="modelCompare" class="model-compare-widget" tabindex="0" role="listbox" aria-multiselectable="true" aria-label="Compare models"></div>
          <button id="clearCompare" class="clear-compare" type="button" title="Unselect all">×</button>
        </div>
      </div>
      <div class="field">
        <label for="search">Search</label>
        <input id="search" type="text" placeholder="Model or creator">
      </div>
      <div class="field">
        <label for="params">Params</label>
        <select id="params"></select>
      </div>
      <div class="field">
        <label for="sortMode">Sort</label>
        <select id="sortMode"></select>
      </div>
    </section>

    <section class="toolbar" id="toolbar" hidden>
      <span class="pill" id="resultCount">0 models</span>
      <span class="pill" id="benchmarkCount">0 benchmarks</span>
      <button id="resetBtn" type="button">Reset Filters</button>
      <button style="display: none" id="importBtn" type="button">Import llm.json</button>
      <input id="importFile" class="file-input-offscreen" type="file" accept="application/json,.json">
    </section>

    <section id="content">
      <div class="status" id="status">Loading benchmark data...</div>
    </section>
  </main>

  <script>
    (function () {
      const PRIORITY_BENCHMARK_KEYS = ["aa_intelligence_index", "aa_coding_index", "swe_bench_verified"];
      const BENCHMARK_LABEL_OVERRIDES = {
        aa_intelligence_index: "Index",
        aa_coding_index: "Coding"
      };

      const state = {
        data: null,
        benchmarkKeys: [],
        filteredModels: [],
        filters: {
          search: "",
          params: "all",
          selectedModels: []
        },
        sort: {
          key: "swe_bench_verified",
          direction: "desc"
        },
        eventsBound: false,
        columnWidths: {}
      };

      const ui = {
        title: document.getElementById("title"),
        controls: document.getElementById("controls"),
        toolbar: document.getElementById("toolbar"),
        content: document.getElementById("content"),
        status: document.getElementById("status"),
        search: document.getElementById("search"),
        params: document.getElementById("params"),
        modelCompare: document.getElementById("modelCompare"),
        sortMode: document.getElementById("sortMode"),
        resultCount: document.getElementById("resultCount"),
        benchmarkCount: document.getElementById("benchmarkCount"),
        importBtn: document.getElementById("importBtn"),
        importFile: document.getElementById("importFile"),
        resetBtn: document.getElementById("resetBtn"),
        clearCompare: document.getElementById("clearCompare")
      };

      bindImportEvents();
      loadData();

      // Theme toggle
      document.getElementById("themeToggle").addEventListener("click", () => {
        const isDark = document.documentElement.getAttribute("data-theme") === "dark";
        document.documentElement.classList.add("theme-transitioning");
        setTimeout(() => document.documentElement.classList.remove("theme-transitioning"), 400);
        if (isDark) {
          document.documentElement.removeAttribute("data-theme");
          localStorage.setItem("theme", "light");
        } else {
          document.documentElement.setAttribute("data-theme", "dark");
          localStorage.setItem("theme", "dark");
        }
      });

      async function loadData() {
        try {
          const cacheBustedUrl = `https://raw.githubusercontent.com/dgrieser/ai-bench/refs/heads/main/llm.json?t=${Date.now()}`;
          const response = await fetch(cacheBustedUrl, { cache: "no-store" });
          if (!response.ok) {
            throw new Error(`Request failed (${response.status})`);
          }
          const data = await response.json();
          validateData(data);
          init(data);
        } catch (err) {
          showImportOnly(`Unable to load llm.json automatically. ${err.message}`);
        }
      }

      function showImportOnly(message) {
        ui.toolbar.hidden = false;
        ui.controls.hidden = true;
        ui.status.classList.add("error");
        ui.status.textContent = message;
        ui.resultCount.textContent = "No data loaded";
        ui.benchmarkCount.textContent = "Import required";
      }

      function validateData(data) {
        if (!data || typeof data !== "object") {
          throw new Error("Invalid JSON root.");
        }
        if (!Array.isArray(data.models) || !data.benchmarks || typeof data.benchmarks !== "object") {
          throw new Error("Expected models[] and benchmarks{}.");
        }
      }

      function init(data) {
        state.data = data;
        state.benchmarkKeys = getOrderedBenchmarkKeys(data.benchmarks);

        ui.title.textContent = data.title || "LLM Benchmarks";
        ui.controls.hidden = false;
        ui.toolbar.hidden = false;
        ui.status.classList.remove("error");

        populateFilters();
        if (!state.eventsBound) {
          bindEvents();
          state.eventsBound = true;
        }
        applyAndRender();
      }

      function bindImportEvents() {
        ui.modelCompare.addEventListener("click", (e) => {
          e.stopPropagation();
          const item = e.target.closest(".model-compare-item");
          if (item) {
            const name = item.dataset.value;
            const idx = state.filters.selectedModels.indexOf(name);
            if (idx >= 0) {
              state.filters.selectedModels.splice(idx, 1);
            } else {
              state.filters.selectedModels.push(name);
            }
            updateCompareWidget();
            applyAndRender();
            return;
          }
          ui.modelCompare.classList.toggle("open");
        });

        ui.modelCompare.addEventListener("focus", () => {
          ui.modelCompare.classList.add("open");
        });

        ui.modelCompare.addEventListener("blur", (e) => {
          if (!ui.modelCompare.contains(e.relatedTarget)) {
            ui.modelCompare.classList.remove("open");
          }
        });

        ui.modelCompare.addEventListener("keydown", (e) => {
          if (e.key === "Escape") ui.modelCompare.classList.remove("open");
        });

        let hoverOpenTimer = null;
        ui.modelCompare.addEventListener("mouseenter", () => {
          if (!ui.modelCompare.classList.contains("open")) {
            hoverOpenTimer = setTimeout(() => {
              ui.modelCompare.classList.add("open");
            }, 1500);
          }
        });
        ui.modelCompare.addEventListener("mouseleave", () => {
          clearTimeout(hoverOpenTimer);
        });

        ui.modelCompare.addEventListener("wheel", (e) => {
          if (!ui.modelCompare.classList.contains("open")) {
            e.preventDefault();
            ui.modelCompare.classList.add("open");
            ui.modelCompare.focus();
          }
        }, { passive: false });

        document.addEventListener("click", () => {
          ui.modelCompare.classList.remove("open");
        });

        ui.importBtn.addEventListener("click", () => {
          ui.importFile.click();
        });

        ui.importFile.addEventListener("change", async (event) => {
          const file = event.target.files && event.target.files[0];
          if (!file) {
            return;
          }

          try {
            const text = await file.text();
            const imported = JSON.parse(text);
            validateData(imported);
            state.filters.search = "";
            state.filters.params = "all";
            state.filters.selectedModels = [];
            state.sort.key = "swe_bench_verified";
            state.sort.direction = "desc";
            ui.search.value = "";
            ui.params.value = "all";
            ui.sortMode.value = sortModeValue(state.sort.key, state.sort.direction);
            init(imported);
          } catch (err) {
            ui.content.innerHTML = `<div class="status error">Import failed: ${escapeHtml(err.message || "Invalid JSON file.")}</div>`;
          } finally {
            ui.importFile.value = "";
          }
        });
      }

      function populateFilters() {
        const modelNames = [...new Set(state.data.models.map((m) => m.name || "Unknown"))].sort((a, b) => a.localeCompare(b));
        ui.modelCompare.innerHTML = modelNames.map((name) => {
          const sel = state.filters.selectedModels.includes(name);
          return `<div class="model-compare-item${sel ? " selected" : ""}" data-value="${escapeHtml(name)}" role="option" aria-selected="${sel}">
            <span class="model-compare-check"></span>
            <span>${escapeHtml(name)}</span>
          </div>`;
        }).join("");

        const paramOptions = [
          { value: "all", label: "All parameter sizes" },
          { value: "lt30", label: "< 30B" },
          { value: "30to80", label: "30B to 80B" },
          { value: "80to130", label: "80B to 130B" },
          { value: "130to250", label: "130B to 250B" },
          { value: "gte250", label: ">= 250B" }
        ];

        ui.params.innerHTML = paramOptions
          .map((option) => `<option value="${escapeHtml(option.value)}">${escapeHtml(option.label)}</option>`)
          .join("");
        ui.params.value = state.filters.params;

        const fixedSortOptions = [
          { key: "name", label: "Model name" },
          { key: "creator", label: "Creator" },
          { key: "params", label: "Params" },
          { key: "context", label: "Context" }
        ];

        const benchmarkSortOptions = state.benchmarkKeys.map((key) => ({
          key,
          label: getBenchmarkLabel(key)
        }));

        const sortOptions = [...fixedSortOptions, ...benchmarkSortOptions];
        ui.sortMode.innerHTML = sortOptions.map((option) => {
          const ascLabel = `${option.label} ↑`;
          const descLabel = `${option.label} ↓`;
          return [
            `<option value="${escapeHtml(sortModeValue(option.key, "desc"))}">${escapeHtml(descLabel)}</option>`,
            `<option value="${escapeHtml(sortModeValue(option.key, "asc"))}">${escapeHtml(ascLabel)}</option>`
          ].join("");
        }).join("");

        ui.sortMode.value = sortModeValue(state.sort.key, state.sort.direction);
      }

      function updateCompareWidget() {
        ui.modelCompare.querySelectorAll(".model-compare-item").forEach((item) => {
          const selected = state.filters.selectedModels.includes(item.dataset.value);
          item.classList.toggle("selected", selected);
          item.setAttribute("aria-selected", String(selected));
        });
      }

      function bindEvents() {
        ui.search.addEventListener("input", debounce((event) => {
          state.filters.search = event.target.value.trim().toLowerCase();
          applyAndRender();
        }, 100));

        ui.params.addEventListener("change", (event) => {
          state.filters.params = event.target.value;
          applyAndRender();
        });

        ui.clearCompare.addEventListener("mousedown", (e) => {
          e.preventDefault(); // prevents blur on modelCompare, keeping it open
          e.stopPropagation();
          state.filters.selectedModels = [];
          updateCompareWidget();
          applyAndRender();
        });

        ui.sortMode.addEventListener("change", (event) => {
          const nextSort = parseSortModeValue(event.target.value);
          state.sort.key = nextSort.key;
          state.sort.direction = nextSort.direction;
          applyAndRender();
        });

        ui.resetBtn.addEventListener("click", () => {
          if (!state.data) {
            return;
          }

          state.filters.search = "";
          state.filters.params = "all";
          state.filters.selectedModels = [];
          state.sort.key = "swe_bench_verified";
          state.sort.direction = "desc";

          ui.search.value = "";
          ui.params.value = "all";

          ui.modelCompare.classList.remove("open");
          updateCompareWidget();
          ui.sortMode.value = sortModeValue(state.sort.key, state.sort.direction);

          applyAndRender();
        });
      }

      function applyAndRender() {
        if (!state.data) {
          return;
        }

        const models = state.data.models
          .map((model) => {
            return {
              ...model,
              creatorName: model.creator?.name || "Unknown"
            };
          })
          .filter((model) => modelPassesFilters(model));

        sortModels(models);
        state.filteredModels = models;

        renderTable();
        updateMeta();
      }

      function modelPassesFilters(model) {
        if (state.filters.search) {
          const haystack = `${model.name || ""} ${model.creatorName}`.toLowerCase();
          if (!haystack.includes(state.filters.search)) {
            return false;
          }
        }

        const modelParams = parseUnitNumber(model.params);
        if (state.filters.params !== "all") {
          if (!Number.isFinite(modelParams)) {
            return false;
          }
          if (state.filters.params === "lt30" && !(modelParams < 30e9)) {
            return false;
          }
          if (state.filters.params === "30to80" && !(modelParams >= 30e9 && modelParams <= 80e9)) {
            return false;
          }
          if (state.filters.params === "80to130" && !(modelParams > 80e9 && modelParams <= 130e9)) {
            return false;
          }
          if (state.filters.params === "130to250" && !(modelParams > 130e9 && modelParams < 250e9)) {
            return false;
          }
          if (state.filters.params === "gte250" && !(modelParams >= 250e9)) {
            return false;
          }
        }

        if (state.filters.selectedModels.length && !state.filters.selectedModels.includes(model.name || "Unknown")) {
          return false;
        }

        return true;
      }

      function sortModels(models) {
        const directionFactor = state.sort.direction === "asc" ? 1 : -1;

        models.sort((a, b) => {
          const left = valueForSort(a, state.sort.key);
          const right = valueForSort(b, state.sort.key);

          const leftMissing = left == null || Number.isNaN(left);
          const rightMissing = right == null || Number.isNaN(right);

          if (leftMissing && rightMissing) {
            return String(a.name || "").localeCompare(String(b.name || ""));
          }
          if (leftMissing) {
            return 1;
          }
          if (rightMissing) {
            return -1;
          }

          if (typeof left === "number" && typeof right === "number") {
            return (left - right) * directionFactor;
          }

          return String(left).localeCompare(String(right)) * directionFactor;
        });
      }

      function valueForSort(model, key) {
        if (key === "name") {
          return model.name || "";
        }
        if (key === "creator") {
          return model.creatorName || "";
        }
        if (key === "params") {
          return parseUnitNumber(model.params);
        }
        if (key === "context") {
          return parseUnitNumber(model.context);
        }
        return toNumber(model.scores?.[key]);
      }

      function renderTable() {
        if (!state.filteredModels.length) {
          ui.content.innerHTML = `
            <div class="empty">No models match your filters.</div>
            ${renderBenchmarkDirectory()}
            ${renderSourcesDirectory()}
          `;
          return;
        }

        const headers = [
          { key: "name", label: "Model", className: "col-model" },
          { key: "creator", label: "Creator" },
          { key: "params", label: "Params", className: "mono" },
          { key: "context", label: "Context", className: "mono" },
          ...state.benchmarkKeys.map((key) => ({
            key,
            label: getBenchmarkLabel(key),
            title: state.data.benchmarks[key]?.description || "",
            className: "num bench-head"
          }))
        ];

        const bestInTableByModel = getBestInTableByModel(state.filteredModels);
        const scoreRanges = getScoreRangesByBenchmark(state.filteredModels);

        const tableHtml = `
          <div class="table-shell">
            <table aria-label="LLM benchmark table">
              <thead>
                <tr>
                  ${headers.map((header) => renderHeaderCell(header)).join("")}
                </tr>
              </thead>
              <tbody>
                ${state.filteredModels.map((model) => renderRow(model, bestInTableByModel.get(model) || new Set(), scoreRanges)).join("")}
              </tbody>
            </table>
          </div>
          ${renderBenchmarkDirectory()}
          ${renderSourcesDirectory()}
        `;

        ui.content.innerHTML = tableHtml;

        ui.content.querySelectorAll("th[data-sort-key]").forEach((th) => {
          th.addEventListener("click", () => {
            const key = th.dataset.sortKey;
            if (!key) {
              return;
            }
            if (state.sort.key === key) {
              state.sort.direction = state.sort.direction === "desc" ? "asc" : "desc";
            } else {
              state.sort.key = key;
              state.sort.direction = key === "name" || key === "creator" ? "asc" : "desc";
            }

            ui.sortMode.value = sortModeValue(state.sort.key, state.sort.direction);
            applyAndRender();
          });
        });

        initColumnResize();
      }

      function renderBenchmarkDirectory() {
        const items = state.benchmarkKeys.map((key) => {
          const benchmark = state.data?.benchmarks?.[key] || {};
          const name = getBenchmarkLabel(key);
          const category = benchmark.category || "";
          const description = benchmark.description || "";
          const links = benchmarkLinks(benchmark);

          return `
            <article class="benchmark-item">
              <div class="benchmark-head">
                <span class="benchmark-name">${escapeHtml(name)}</span>
                ${category ? `<span class="benchmark-category">${escapeHtml(category)}</span>` : ""}
              </div>
              ${description ? `<p class="benchmark-desc">${escapeHtml(description)}</p>` : ""}
              ${links.length ? `<div class="benchmark-links">${links.map((url) => `<a href="${escapeAttr(url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(url)}</a>`).join("")}</div>` : ""}
            </article>
          `;
        }).join("");

        return `
          <section class="benchmarks-panel" aria-label="Benchmark details">
            <h2>Benchmarks</h2>
            <div class="benchmarks-list">${items}</div>
          </section>
        `;
      }

      function renderSourcesDirectory() {
        const sources = state.data?.sources;
        if (!Array.isArray(sources) || !sources.length) {
          return "";
        }

        const links = sources
          .filter((url) => typeof url === "string" && url.trim().length > 0)
          .sort((a, b) => a.localeCompare(b))
          .map((url) => `<a href="${escapeAttr(url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(url)}</a>`)
          .join("");

        return `
          <section class="sources-panel" aria-label="Sources">
            <h2>Sources</h2>
            <div class="sources-list">${links}</div>
          </section>
        `;
      }

      function benchmarkLinks(benchmark) {
        if (!benchmark || typeof benchmark !== "object") {
          return [];
        }
        if (Array.isArray(benchmark.urls)) {
          return benchmark.urls.filter((url) => typeof url === "string" && url.trim().length > 0);
        }
        if (typeof benchmark.url === "string" && benchmark.url.trim().length > 0) {
          return [benchmark.url];
        }
        return [];
      }

      function initColumnResize() {
        const table = ui.content.querySelector("table");
        if (!table) return;
        const ths = table.querySelectorAll("thead th");

        // Capture natural widths for columns not yet stored
        ths.forEach((th) => {
          const key = th.dataset.sortKey;
          if (key && !state.columnWidths[key]) {
            state.columnWidths[key] = th.getBoundingClientRect().width;
          }
        });

        // Switch to fixed layout and apply stored widths
        table.style.tableLayout = "fixed";
        ths.forEach((th) => {
          const key = th.dataset.sortKey;
          if (key && state.columnWidths[key]) {
            th.style.width = state.columnWidths[key] + "px";
          }
        });

        // Attach mousedown listeners to resize handles
        table.querySelectorAll(".col-resize-handle").forEach((handle) => {
          handle.addEventListener("mousedown", onResizeMouseDown);
        });
      }

      function onResizeMouseDown(e) {
        e.preventDefault();
        e.stopPropagation();

        const handle = e.currentTarget;
        const th = handle.closest("th");
        const key = handle.dataset.resizeKey;
        if (!th || !key) return;

        const startX = e.clientX;
        const startWidth = th.getBoundingClientRect().width;

        document.body.classList.add("col-resizing");

        function onMouseMove(e) {
          const newWidth = Math.max(50, startWidth + (e.clientX - startX));
          th.style.width = newWidth + "px";
        }

        function onMouseUp(e) {
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", onMouseUp);
          document.body.classList.remove("col-resizing");

          const finalWidth = Math.max(50, startWidth + (e.clientX - startX));
          state.columnWidths[key] = finalWidth;
          th.style.width = finalWidth + "px";

          // Swallow the click event the browser fires after mouseup so sort doesn't trigger
          th.addEventListener("click", (ev) => ev.stopPropagation(), { capture: true, once: true });
        }

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
      }

      function renderHeaderCell(header) {
        const isSorted = state.sort.key === header.key;
        const sortSymbol = isSorted ? (state.sort.direction === "desc" ? "▼" : "▲") : "";
        const indicator = isSorted ? `<span class="sort-indicator">${sortSymbol}</span>` : "";

        const className = header.className ? ` ${header.className}` : "";
        const title = header.title ? ` title="${escapeHtml(header.title)}"` : "";

        const resizeHandle = `<div class="col-resize-handle" data-resize-key="${escapeHtml(header.key)}"></div>`;
        return `<th class="${className.trim()}" data-sort-key="${escapeHtml(header.key)}"${title}><span class="th-label">${escapeHtml(header.label)}</span>${indicator}${resizeHandle}</th>`;
      }

      function isRecentModel(model) {
        if (!model.date_added) return false;
        const added = new Date(model.date_added + "T00:00:00");
        const now = new Date();
        const diffMs = now.getTime() - added.getTime();
        return diffMs >= 0 && diffMs < 7 * 24 * 60 * 60 * 1000;
      }

      function renderNewBadge(dateAdded) {
        const pts = "100,10 118.1,32.4 145,22 149.5,50.5 177.9,55 167.6,81.9 190,100 167.6,118.1 177.9,145 149.5,149.5 145,177.9 118.1,167.6 100,190 81.9,167.6 55,177.9 50.5,149.5 22.1,145 32.4,118.1 10,100 32.4,81.9 22.1,55 50.5,50.5 55,22 81.9,32.4";
        const label = dateAdded ? `Added ${escapeHtml(dateAdded)}` : "Recently added";
        return (
          `<span class="new-badge" title="${label}">` +
          `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="22" height="22" aria-label="New model">` +
          `<g transform="rotate(-12 100 100)">` +
          `<polygon points="${pts}" fill="url(#new-badge-grad)" stroke="#FFFFFF" stroke-width="8" stroke-linejoin="round" filter="url(#new-badge-shadow)"/>` +
          `<text x="100" y="116" font-family="'Impact','Arial Black',sans-serif" font-size="46" font-weight="900" fill="#FFFFFF" text-anchor="middle" letter-spacing="1">NEW</text>` +
          `</g>` +
          `</svg>` +
          `</span>`
        );
      }

      function renderRow(model, bestInTable, scoreRanges) {
        const modelName = escapeHtml(model.name || "Unknown");
        const modelUrl = model.url || "";
        const creatorName = escapeHtml(model.creatorName);
        const creatorUrl = model.creator?.url || "";
        const isNew = isRecentModel(model);
        const scoreCells = state.benchmarkKeys.map((key) => {
          const value = toNumber(model.scores?.[key]);
          const isTop = bestInTable.has(key);
          if (isTop) {
            return `<td class="num top-score"><span class="top-score-mark">${formatScore(value)}</span></td>`;
          }
          const grey = Number.isFinite(value) ? scoreToGrey(value, scoreRanges[key]) : null;
          const style = grey ? ` style="color:${grey}"` : "";
          return `<td class="num"${style}>${formatScore(value)}</td>`;
        }).join("");

        return `
          <tr>
            <td class="col-model">${modelUrl ? `<a href="${escapeAttr(modelUrl)}" target="_blank" rel="noopener noreferrer"${isNew ? ' class="model-new"' : ""}>${modelName}</a>` : (isNew ? `<span class="model-new">${modelName}</span>` : modelName)}${isNew ? renderNewBadge(model.date_added) : ""}</td>
            <td class="creator">${creatorUrl ? `<a href="${escapeAttr(creatorUrl)}" target="_blank" rel="noopener noreferrer">${creatorName}</a>` : creatorName}</td>
            <td class="mono">${escapeHtml(model.params || "-")}</td>
            <td class="mono">${escapeHtml(model.context || "-")}</td>
            ${scoreCells}
          </tr>
        `;
      }

      function updateMeta() {
        const shown = state.filteredModels.length;
        const total = state.data.models.length;
        ui.resultCount.textContent = `${shown} of ${total} models`;
        ui.benchmarkCount.textContent = `${state.benchmarkKeys.length} benchmarks`;
      }

      function getTopScoresByBenchmark(models) {
        const topScores = {};
        state.benchmarkKeys.forEach((key) => {
          const values = models
            .map((model) => toNumber(model.scores?.[key]))
            .filter((value) => Number.isFinite(value));
          topScores[key] = values.length ? Math.max(...values) : Number.NaN;
        });
        return topScores;
      }

      function getScoreRangesByBenchmark(models) {
        const ranges = {};
        state.benchmarkKeys.forEach((key) => {
          const values = models
            .map((m) => toNumber(m.scores?.[key]))
            .filter((v) => Number.isFinite(v));
          if (!values.length) { ranges[key] = null; return; }
          const top = Math.max(...values);
          const nonTop = values.filter((v) => !nearlyEqual(v, top));
          ranges[key] = {
            top,
            second: nonTop.length ? Math.max(...nonTop) : null,
            min: nonTop.length ? Math.min(...nonTop) : null
          };
        });
        return ranges;
      }

      function scoreToGrey(score, range) {
        if (!range || range.second === null || !Number.isFinite(score)) return null;
        const { second, min } = range;
        // t = 0 at min (most muted), t = 1 at second-best (most prominent)
        const t = nearlyEqual(second, min) ? 1 : Math.max(0, Math.min(1, (score - min) / (second - min)));
        const isDark = document.documentElement.getAttribute("data-theme") === "dark";
        // light: #8b8b8b (channel 139) → #111111 (channel 17)
        // dark:  #6e6e6e (channel 110) → #aaaaaa (channel 170) — flipped & lifted for dark bg
        const channel = isDark
          ? Math.round(110 + 60 * t)
          : Math.round(139 - 122 * t);
        const hex = channel.toString(16).padStart(2, "0");
        return `#${hex}${hex}${hex}`;
      }

      function getOrderedBenchmarkKeys(benchmarks) {
        const keys = Object.keys(benchmarks || {});
        const prioritized = PRIORITY_BENCHMARK_KEYS.filter((key) => keys.includes(key));
        const remaining = keys.filter((key) => !PRIORITY_BENCHMARK_KEYS.includes(key));
        return [...prioritized, ...remaining];
      }

      function getBenchmarkLabel(key) {
        return BENCHMARK_LABEL_OVERRIDES[key] || state.data?.benchmarks?.[key]?.name || key;
      }

      function getBestInTableByModel(models) {
        const result = new Map();
        models.forEach((model) => result.set(model, new Set()));

        if (!models.length) {
          return result;
        }

        const topByBenchmark = getTopScoresByBenchmark(models);
        const topContext = Math.max(...models.map((m) => parseUnitNumber(m.context)).filter((v) => Number.isFinite(v)));

        models.forEach((model) => {
          const flags = result.get(model);
          if (!flags) {
            return;
          }

          const contextValue = parseUnitNumber(model.context);
          if (Number.isFinite(contextValue) && Number.isFinite(topContext) && nearlyEqual(contextValue, topContext)) {
            flags.add("context");
          }

          state.benchmarkKeys.forEach((key) => {
            const value = toNumber(model.scores?.[key]);
            const top = topByBenchmark[key];
            if (Number.isFinite(value) && Number.isFinite(top) && nearlyEqual(value, top)) {
              flags.add(key);
            }
          });
        });

        return result;
      }

      function formatScore(value) {
        if (!Number.isFinite(value)) {
          return '<span class="num na">&mdash;&nbsp;</span>';
        }
        return value.toFixed(1);
      }

      function toNumber(value) {
        if (typeof value === "number" && Number.isFinite(value)) {
          return value;
        }
        if (typeof value === "string") {
          const parsed = Number(value);
          return Number.isFinite(parsed) ? parsed : Number.NaN;
        }
        return Number.NaN;
      }

      function parseUnitNumber(raw) {
        if (raw == null) {
          return Number.NaN;
        }

        const text = String(raw).trim().toLowerCase();
        const match = text.match(/([0-9]*\.?[0-9]+)\s*([a-z]+)/);
        if (!match) {
          const plain = Number(text.replace(/,/g, ""));
          return Number.isFinite(plain) ? plain : Number.NaN;
        }

        const value = Number(match[1]);
        const unit = match[2];
        if (!Number.isFinite(value)) {
          return Number.NaN;
        }

        const multipliers = {
          k: 1e3,
          m: 1e6,
          b: 1e9,
          t: 1e12
        };

        const tail = unit[0];
        if (tail in multipliers) {
          return value * multipliers[tail];
        }

        return value;
      }

      function nearlyEqual(a, b) {
        return Math.abs(a - b) < 1e-9;
      }

      function sortModeValue(key, direction) {
        return `${key}::${direction}`;
      }

      function parseSortModeValue(value) {
        const parts = String(value).split("::");
        const key = parts[0] || "swe_bench_verified";
        const direction = parts[1] === "asc" ? "asc" : "desc";
        return { key, direction };
      }

      function escapeHtml(value) {
        return String(value)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/\"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function escapeAttr(value) {
        return escapeHtml(value);
      }

      function debounce(fn, delayMs) {
        let timer;
        return function (...args) {
          clearTimeout(timer);
          timer = setTimeout(() => fn.apply(this, args), delayMs);
        };
      }
    })();
  </script>
</body>
</html>
